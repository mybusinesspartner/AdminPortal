<div class="deleted-users-container">
  <header class="deleted-users-header">
    <div class="header-content">
      <button class="back-button" (click)="goBack()">← Back to Dashboard</button>
      <h1>Deleted Users</h1>
      <button class="logout-button" (click)="logout()">
        <svg class="logout-icon" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path>
          <polyline points="16 17 21 12 16 7"></polyline>
          <line x1="21" y1="12" x2="9" y2="12"></line>
        </svg>
        Logout
      </button>
    </div>
  </header>

  <main class="deleted-users-main">
    <div class="tabs-container">
      <div class="tabs">
        <button
          class="tab-button"
          [class.active]="activeTab === 'all'"
          (click)="switchTab('all')"
        >
          <svg class="tab-icon" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M9 11l3 3L22 4"></path>
            <path d="M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h7"></path>
          </svg>
          <span>All Deletions</span>
          <span class="tab-count" *ngIf="allCount > 0">{{ allCount }}</span>
        </button>
        <button
          class="tab-button"
          [class.active]="activeTab === 'user_initiated'"
          (click)="switchTab('user_initiated')"
        >
          <svg class="tab-icon" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
            <circle cx="12" cy="7" r="4"></circle>
          </svg>
          <span>User Deletions</span>
          <span class="tab-count" *ngIf="userInitiatedCount > 0">{{ userInitiatedCount }}</span>
        </button>
        <button
          class="tab-button"
          [class.active]="activeTab === 'admin_initiated'"
          (click)="switchTab('admin_initiated')"
        >
          <svg class="tab-icon" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
            <circle cx="9" cy="7" r="4"></circle>
            <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
            <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
          </svg>
          <span>Admin Deletions</span>
          <span class="tab-count" *ngIf="adminInitiatedCount > 0">{{ adminInitiatedCount }}</span>
        </button>
      </div>
    </div>

    <div class="filters-section">
      <div class="search-box">
        <input
          type="text"
          placeholder="Search by name, email, message, or reason..."
          [(ngModel)]="searchTerm"
          (input)="onSearchChange()"
          class="search-input"
        />
      </div>
    </div>

    <div class="deleted-users-list" *ngIf="!isLoading">
      <div
        *ngFor="let deletedUser of paginatedUsers"
        class="deleted-user-card"
        [ngClass]="{'user-initiated': deletedUser.deletionType === 'user_initiated', 'admin-initiated': deletedUser.deletionType === 'admin_initiated'}"
      >
        <div class="deletion-type-badge" [ngClass]="{'user-badge': deletedUser.deletionType === 'user_initiated', 'admin-badge': deletedUser.deletionType === 'admin_initiated'}">
          <svg *ngIf="deletedUser.deletionType === 'user_initiated'" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
            <circle cx="12" cy="7" r="4"></circle>
          </svg>
          <svg *ngIf="deletedUser.deletionType === 'admin_initiated'" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
            <circle cx="9" cy="7" r="4"></circle>
            <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
            <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
          </svg>
          {{ deletedUser.deletionType === 'user_initiated' ? 'User Deleted' : 'Admin Deleted' }}
        </div>

        <div class="user-header">
          <div class="user-info">
            <div class="user-avatar">
              <div class="avatar-circle">
                {{ deletedUser.user.name.charAt(0).toUpperCase() }}
              </div>
            </div>
            <div class="user-details">
              <h3 class="user-name">{{ deletedUser.user.name }}</h3>
              <div class="user-meta">
                <span class="user-email">
                  <svg class="icon" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                    <path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"/>
                    <polyline points="22,6 12,13 2,6"/>
                  </svg>
                  {{ deletedUser.user.email }}
                </span>
                <span class="user-phone">
                  <svg class="icon" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                    <path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"/>
                  </svg>
                  {{ deletedUser.user.phone }}
                </span>
              </div>
            </div>
          </div>
          <div class="deletion-info">
            <div class="deleted-date">
              <svg class="date-icon" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                <polyline points="3 6 5 6 21 6"/>
                <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/>
              </svg>
              Deleted: {{ deletedUser.deletedAt | date:'MMM d, y h:mm a' }}
            </div>
            <div class="deleted-by" *ngIf="deletedUser.deletedBy">
              <svg class="icon" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                <circle cx="9" cy="7" r="4"></circle>
                <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
                <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
              </svg>
              By: {{ deletedUser.deletedBy }}
            </div>
          </div>
        </div>

        <div class="user-content">
          <div class="info-grid">
            <div class="info-item">
              <div class="info-label">
                <svg class="info-icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                  <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                  <circle cx="9" cy="7" r="4"></circle>
                  <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
                  <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
                </svg>
                Business Type
              </div>
              <div class="info-value business-type-badge" 
                   [ngClass]="{'business-type-corporate': deletedUser.user.businessType === 'Corporate Business', 
                               'business-type-local': deletedUser.user.businessType === 'Local Business'}">
                {{ deletedUser.user.businessType }}
              </div>
            </div>

            <div class="info-item">
              <div class="info-label">
                <svg class="info-icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                  <path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"></path>
                  <path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"/>
                </svg>
                College
              </div>
              <div class="info-value">{{ deletedUser.user.collegeName }}</div>
            </div>

            <div class="info-item">
              <div class="info-label">
                <svg class="info-icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                  <circle cx="12" cy="12" r="10"></circle>
                  <polyline points="12 6 12 12 16 14"/>
                </svg>
                Year of Passout
              </div>
              <div class="info-value">{{ deletedUser.user.yearOfPassout }}</div>
            </div>
          </div>

          <!-- Deletion Message/Reason Section -->
          <div class="message-section" *ngIf="(deletedUser.deletionType === 'user_initiated' && deletedUser.userMessage) || (deletedUser.deletionType === 'admin_initiated' && deletedUser.adminReason)">
            <div class="message-label">
              <svg *ngIf="deletedUser.deletionType === 'user_initiated'" class="info-icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/>
              </svg>
              <svg *ngIf="deletedUser.deletionType === 'admin_initiated'" class="info-icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                <polyline points="14 2 14 8 20 8"/>
                <line x1="16" y1="13" x2="8" y2="13"/>
                <line x1="16" y1="17" x2="8" y2="17"/>
              </svg>
              <span *ngIf="deletedUser.deletionType === 'user_initiated'">User's Deletion Message</span>
              <span *ngIf="deletedUser.deletionType === 'admin_initiated'">Admin Deletion Reason</span>
            </div>
            <div class="message-text" 
                 [ngClass]="{'user-message': deletedUser.deletionType === 'user_initiated', 'admin-reason': deletedUser.deletionType === 'admin_initiated'}">
              {{ deletedUser.deletionType === 'user_initiated' ? deletedUser.userMessage : deletedUser.adminReason }}
            </div>
          </div>
        </div>
      </div>

      <div class="no-users" *ngIf="filteredUsers.length === 0">
        <p>No deleted users found matching your criteria.</p>
      </div>

      <!-- Pagination Controls -->
      <div class="pagination-container" *ngIf="filteredUsers.length > 0 && !isLoading">
        <div class="pagination-info">
          <span>
            Showing {{ (currentPage - 1) * itemsPerPage + 1 }} -
            {{ getMin(currentPage * itemsPerPage, filteredUsers.length) }}
            of {{ filteredUsers.length }} deleted users
          </span>
        </div>
        <div class="pagination-controls-wrapper">
          <div class="page-size-selector">
            <label for="pageSize">Items per page:</label>
            <select
              id="pageSize"
              [(ngModel)]="itemsPerPage"
              (change)="onPageSizeChange()"
              class="page-size-select"
            >
              <option *ngFor="let size of pageSizeOptions" [value]="size">
                {{ size }}
              </option>
            </select>
          </div>
          <div class="pagination-controls">
            <button
              class="pagination-button"
              [disabled]="currentPage === 1"
              (click)="previousPage()"
              aria-label="Previous page"
            >
              ‹ Previous
            </button>

            <div class="page-numbers">
              <button
                *ngFor="let page of getPageNumbers()"
                class="page-number"
                [class.active]="page === currentPage"
                (click)="goToPage(page)"
              >
                {{ page }}
              </button>
            </div>

            <button
              class="pagination-button"
              [disabled]="currentPage === totalPages"
              (click)="nextPage()"
              aria-label="Next page"
            >
              Next ›
            </button>
          </div>
        </div>
      </div>
    </div>

    <div class="loading-state" *ngIf="isLoading">
      <div class="spinner"></div>
      <p>Loading deleted users...</p>
    </div>
  </main>
</div>

